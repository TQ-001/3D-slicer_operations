# Mount from local path first
mkdir -p "$HOME/comic_cluster"
sshfs username@comic.cs.ucl.ac.uk:/ "$HOME/comic_cluster"


import os
import slicer

# 1) txt pathï¼šexpanduser then open
txt_path = os.path.expanduser(
    "~/comic_cluster/SAN/medic/Cardiac_SUMMIT/ipf/batch_id_QC/Dutch_batch3.txt"
)

print("TXT:", txt_path)
print("TXT exists:", os.path.exists(txt_path))

with open(txt_path, "r") as f:
    ids = [line.strip() for line in f if line.strip()]

print("IDs loaded:", len(ids))
if ids:
    print("First 5 IDs:", ids[:5])

# 2) base path ~
base_img_dir = os.path.expanduser(
    "~/comic_cluster/SAN/medic/hipct_seg/IPF_clinical_data/Dutch2_insp_nifti_LPS"
)
base_seg_dir = os.path.expanduser(
    "~/comic_cluster/SAN/medic/hipct_seg/IPF_clinical_data/Dutch2_insp_nifti_LPS/Satsuma_Labs_A/task_233"
)

print("IMG dir:", base_img_dir, "exists:", os.path.isdir(base_img_dir))
print("SEG dir:", base_seg_dir, "exists:", os.path.isdir(base_seg_dir))

loaded_vol = 0
loaded_seg = 0
missing_img = 0
missing_seg = 0

for i, pid in enumerate(ids):
    image_path = os.path.join(base_img_dir, f"{pid}_0000.nii.gz")
    seg_path   = os.path.join(base_seg_dir, f"{pid}.nii.gz")

    img_ok = os.path.exists(image_path)
    seg_ok = os.path.exists(seg_path)

    # print after a number of loading
    if i < 5 or (i % 50 == 0):
        print(f"[{i}/{len(ids)}] {pid} | img:{img_ok} seg:{seg_ok}")

    if img_ok:
        ok = slicer.util.loadVolume(image_path, {"show": False})
        if ok:
            loaded_vol += 1
        else:
            print("  FAILED loadVolume:", image_path)
    else:
        missing_img += 1

    if seg_ok:
        ok = slicer.util.loadSegmentation(seg_path, {"show": False})
        if ok:
            loaded_seg += 1
        else:
            print("  FAILED loadSegmentation:", seg_path)
    else:
        missing_seg += 1

print("\n===== Summary =====")
print("Volumes loaded:", loaded_vol)
print("Segmentations loaded:", loaded_seg)
print("Missing image:", missing_img)
print("Missing seg:", missing_seg)
